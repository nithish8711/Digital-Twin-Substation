{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/oceanberg-digital-twin/components/dashboard/interactive-map.tsx"],"sourcesContent":["\"use client\"\n\nimport { useEffect, useState } from \"react\"\nimport { MapContainer, TileLayer, Marker, Popup, useMap } from \"react-leaflet\"\nimport { DUMMY_SUBSTATIONS } from \"@/lib/dummy-data\"\nimport Link from \"next/link\"\nimport { ExternalLink } from \"lucide-react\"\n\n// Component to handle map view updates\nfunction MapUpdater({ center }: { center: [number, number] }) {\n  const map = useMap()\n\n  useEffect(() => {\n    map.setView(center, 7)\n  }, [center, map])\n\n  return null\n}\n\ninterface InteractiveMapProps {\n  searchQuery: string\n  selectedVoltage: string\n  selectedOperator: string\n}\n\nexport function InteractiveMap({ searchQuery, selectedVoltage, selectedOperator }: InteractiveMapProps) {\n  const [userLocation, setUserLocation] = useState<[number, number] | null>(null)\n  const [isMounted, setIsMounted] = useState(false)\n  const [L, setL] = useState<any>(null)\n\n  useEffect(() => {\n    setIsMounted(true)\n    // Dynamically import Leaflet on the client only to avoid SSR/module issues\n    import(\"leaflet\").then((leaflet) => {\n      const L = leaflet.default || leaflet\n      setL(L)\n\n      // Fix default marker icon\n      delete (L.Icon.Default.prototype as any)._getIconUrl\n      L.Icon.Default.mergeOptions({\n        iconRetinaUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png\",\n        iconUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png\",\n        shadowUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png\",\n      })\n    })\n\n    if (navigator.geolocation) {\n      navigator.geolocation.getCurrentPosition(\n        (position) => {\n          setUserLocation([position.coords.latitude, position.coords.longitude])\n          console.log(\"[v0] User location:\", position.coords.latitude, position.coords.longitude)\n        },\n        (error) => {\n          console.log(\"[v0] Geolocation error:\", error.message)\n        },\n      )\n    }\n  }, [])\n\n  // Filter substations based on search and filters\n  const filteredSubstations = DUMMY_SUBSTATIONS.filter((station) => {\n    const matchesSearch =\n      searchQuery === \"\" ||\n      station.master.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      station.master.areaName.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      station.master.substationCode.toLowerCase().includes(searchQuery.toLowerCase())\n\n    const matchesVoltage = selectedVoltage === \"all\" || station.master.voltageClass === selectedVoltage\n\n    const matchesOperator = selectedOperator === \"all\" || station.master.operator === selectedOperator\n\n    return matchesSearch && matchesVoltage && matchesOperator\n  })\n\n  // Calculate center point of filtered substations or use default\n  const center: [number, number] =\n    filteredSubstations.length > 0\n      ? [filteredSubstations[0].master.latitude, filteredSubstations[0].master.longitude]\n      : [11.0168, 78.5]\n\n  if (!isMounted || !L) {\n    return (\n      <div className=\"h-full w-full flex items-center justify-center bg-slate-100 rounded-lg\">\n        <p className=\"text-slate-400\">Loading map...</p>\n      </div>\n    )\n  }\n\n  return (\n    <>\n      <link\n        rel=\"stylesheet\"\n        href=\"https://unpkg.com/leaflet@1.9.4/dist/leaflet.css\"\n        integrity=\"sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=\"\n        crossOrigin=\"\"\n      />\n\n      <MapContainer\n        center={center}\n        zoom={7}\n        scrollWheelZoom={true}\n        style={{ height: \"100%\", width: \"100%\", borderRadius: \"0.5rem\" }}\n        className=\"z-0\"\n      >\n        <MapUpdater center={center} />\n        <TileLayer\n          attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n          url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n        />\n\n        {/* Render substation markers */}\n        {filteredSubstations.map((station) => (\n          <Marker key={station.id} position={[station.master.latitude, station.master.longitude]}>\n            <Popup className=\"custom-popup\">\n              <div className=\"space-y-2 p-1 min-w-[250px]\">\n                <h3 className=\"font-bold text-base text-gray-900\">{station.master.name}</h3>\n                <div className=\"space-y-1 text-sm\">\n                  <p className=\"text-gray-600\">\n                    <span className=\"font-medium\">Code:</span> {station.master.substationCode}\n                  </p>\n                  <p className=\"text-gray-600\">\n                    <span className=\"font-medium\">Area:</span> {station.master.areaName}\n                  </p>\n                  <p className=\"text-gray-600\">\n                    <span className=\"font-medium\">Voltage:</span> {station.master.voltageClass}\n                  </p>\n                  <p className=\"text-gray-600\">\n                    <span className=\"font-medium\">Operator:</span> {station.master.operator}\n                  </p>\n                  <p className=\"text-gray-600\">\n                    <span className=\"font-medium\">Installed:</span> {station.master.installationYear}\n                  </p>\n                  {station.master.notes && <p className=\"text-gray-500 text-xs italic mt-2\">{station.master.notes}</p>}\n                  <div className=\"pt-2 mt-2 border-t\">\n                    <Link\n                      href={`/asset-details/${station.id}`}\n                      className=\"inline-flex items-center gap-1 text-blue-600 hover:text-blue-700 text-sm font-medium\"\n                    >\n                      View Full Details\n                      <ExternalLink className=\"h-3 w-3\" />\n                    </Link>\n                  </div>\n                </div>\n              </div>\n            </Popup>\n          </Marker>\n        ))}\n\n        {/* Show user location marker if available */}\n        {userLocation && (\n          <Marker\n            position={userLocation}\n            icon={\n              new L.Icon({\n                iconUrl:\n                  \"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png\",\n                shadowUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png\",\n                iconSize: [25, 41],\n                iconAnchor: [12, 41],\n                popupAnchor: [1, -34],\n                shadowSize: [41, 41],\n              })\n            }\n          >\n            <Popup>\n              <div className=\"text-sm font-medium\">Your Location</div>\n            </Popup>\n          </Marker>\n        )}\n      </MapContainer>\n    </>\n  )\n}\n"],"names":[],"mappings":"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"}}]
}